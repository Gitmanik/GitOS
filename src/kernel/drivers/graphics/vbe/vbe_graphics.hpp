//
// Created by Pawel Reich on 1/23/25.
//

#pragma once
#include <stdint.h>
#include <fs/memory/MemoryFS.hpp>

#include "drivers/graphics/graphics.hpp"

class VBEGraphics : public Graphics {
public:
    static Graphics* the();

    virtual void draw_pixel(uint32_t x, uint32_t y, uint32_t color);

    virtual void draw_char(uint32_t x, uint32_t y, char c, uint32_t color);

    virtual void draw_string(uint32_t x, uint32_t y, const char* str, uint32_t color);

    virtual void print_char(char c);

    virtual void print_char_color(char c, TEXT_MODE_COLOR color);

    virtual void print_string(const char* str);
    virtual void print_string_color(const char* str, TEXT_MODE_COLOR color);

    virtual void clear_screen();

    virtual void set_cursor(uint32_t x, uint32_t y);
    virtual uint32_t get_cursor_x();
    virtual uint32_t get_cursor_y();
    virtual TEXT_MODE_COLOR get_current_color();
    virtual void set_text_color(TEXT_MODE_COLOR color);

    void scroll_screen(int i);
    bool is_vbe() const;


    uint32_t get_rrggbb_color(TEXT_MODE_COLOR color);
    uint32_t get_framebuffer_size() const;
    uint32_t get_bpp() const;
    uint32_t get_height() const;
    uint32_t get_width() const;
    uint8_t *get_framebuffer() const;

    void setup(uint8_t* framebuffer, uint32_t bpp, uint32_t width, uint32_t height);
    void mount_fb();

private:

    uint8_t* FRAMEBUFFER;
    uint32_t WIDTH;
    uint32_t HEIGHT;
    uint32_t BPP;
    uint32_t PITCH;

    bool m_setup = false;

    MemoryFS* m_memoryfs;

    const uint32_t FONT_SCALE = 1;

    uint32_t current_x = 0, current_y = 0;
    TEXT_MODE_COLOR current_color = WHITE;

   const uint8_t font[128][8] = {
        {0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000}, // ASCII 0x20
        {0b00000000, 0b00000000, 0b00100000, 0b00100000, 0b00100000, 0b00100000, 0b00000000, 0b00100000}, // ASCII 0x21
        {0b00000000, 0b00000000, 0b01010000, 0b01010000, 0b00000000, 0b00000000, 0b00000000, 0b00000000}, // ASCII 0x22
        {0b00000000, 0b00110000, 0b01010000, 0b11111000, 0b01010000, 0b11111000, 0b01100000, 0b10100000}, // ASCII 0x23
        {0b00000000, 0b00000000, 0b00100000, 0b11111000, 0b10100000, 0b01110000, 0b00101000, 0b11111000}, // ASCII 0x24
        {0b00000000, 0b00000000, 0b11100000, 0b10100000, 0b11110000, 0b01111000, 0b00101000, 0b00111000}, // ASCII 0x25
        {0b00000000, 0b00000000, 0b00111000, 0b00100000, 0b00110000, 0b01011000, 0b01010000, 0b00111000}, // ASCII 0x26
        {0b00000000, 0b00000000, 0b00100000, 0b00100000, 0b00000000, 0b00000000, 0b00000000, 0b00000000}, // ASCII 0x27
        {0b00000000, 0b00010000, 0b00100000, 0b00100000, 0b00100000, 0b00100000, 0b00100000, 0b00010000}, // ASCII 0x28
        {0b00000000, 0b01000000, 0b00100000, 0b00100000, 0b00100000, 0b00100000, 0b00100000, 0b01000000}, // ASCII 0x29
        {0b00000000, 0b00000000, 0b10101000, 0b01110000, 0b01110000, 0b10101000, 0b00000000, 0b00000000}, // ASCII 0x2A
        {0b00000000, 0b00000000, 0b00000000, 0b00100000, 0b00100000, 0b11111000, 0b00100000, 0b00100000}, // ASCII 0x2B
        {0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00100000}, // ASCII 0x2C
        {0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b01100000, 0b00000000, 0b00000000}, // ASCII 0x2D
        {0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00100000}, // ASCII 0x2E
        {0b00000000, 0b00000000, 0b00010000, 0b00100000, 0b00100000, 0b01100000, 0b01000000, 0b01000000}, // ASCII 0x2F
        {0b00000000, 0b00000000, 0b00110000, 0b01001000, 0b01101000, 0b01001000, 0b01001000, 0b00110000}, // ASCII 0x30
        {0b00000000, 0b00000000, 0b01100000, 0b00100000, 0b00100000, 0b00100000, 0b00100000, 0b01110000}, // ASCII 0x31
        {0b00000000, 0b00000000, 0b01110000, 0b00001000, 0b00001000, 0b00010000, 0b00100000, 0b01111000}, // ASCII 0x32
        {0b00000000, 0b00000000, 0b01110000, 0b00001000, 0b00001000, 0b00110000, 0b00001000, 0b01111000}, // ASCII 0x33
        {0b00000000, 0b00000000, 0b00010000, 0b00110000, 0b00110000, 0b01010000, 0b01111000, 0b00010000}, // ASCII 0x34
        {0b00000000, 0b00000000, 0b01111000, 0b01000000, 0b01110000, 0b00001000, 0b00001000, 0b01110000}, // ASCII 0x35
        {0b00000000, 0b00000000, 0b00111000, 0b01100000, 0b01000000, 0b01111000, 0b01001000, 0b00111000}, // ASCII 0x36
        {0b00000000, 0b00000000, 0b01111000, 0b00001000, 0b00010000, 0b00010000, 0b00010000, 0b00100000}, // ASCII 0x37
        {0b00000000, 0b00000000, 0b00110000, 0b01001000, 0b01001000, 0b00110000, 0b01001000, 0b01111000}, // ASCII 0x38
        {0b00000000, 0b00000000, 0b01110000, 0b01001000, 0b01111000, 0b00001000, 0b00011000, 0b01110000}, // ASCII 0x39
        {0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00100000, 0b00000000, 0b00000000, 0b00100000}, // ASCII 0x3A
        {0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00100000, 0b00000000, 0b00000000, 0b00100000}, // ASCII 0x3B
        {0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00001000, 0b01110000, 0b01100000, 0b00011000}, // ASCII 0x3C
        {0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b11110000, 0b00000000, 0b11110000, 0b00000000}, // ASCII 0x3D
        {0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b01000000, 0b00111000, 0b00011000, 0b01100000}, // ASCII 0x3E
        {0b00000000, 0b00000000, 0b01110000, 0b00110000, 0b00100000, 0b00100000, 0b00000000, 0b00100000}, // ASCII 0x3F
        {0b00000000, 0b00000000, 0b00000000, 0b00110000, 0b01001000, 0b01011000, 0b01011000, 0b01000000}, // ASCII 0x40
        {0b00000000, 0b00000000, 0b00110000, 0b00110000, 0b00110000, 0b00110000, 0b01111000, 0b01001000}, // ASCII 0x41
        {0b00000000, 0b00000000, 0b01110000, 0b01001000, 0b01001000, 0b01110000, 0b01001000, 0b01111000}, // ASCII 0x42
        {0b00000000, 0b00000000, 0b00111000, 0b01000000, 0b01000000, 0b01000000, 0b01000000, 0b00111000}, // ASCII 0x43
        {0b00000000, 0b00000000, 0b01110000, 0b01001000, 0b01001000, 0b01001000, 0b01001000, 0b01110000}, // ASCII 0x44
        {0b00000000, 0b00000000, 0b01111000, 0b01000000, 0b01000000, 0b01111000, 0b01000000, 0b01111000}, // ASCII 0x45
        {0b00000000, 0b00000000, 0b01111000, 0b01000000, 0b01000000, 0b01111000, 0b01000000, 0b01000000}, // ASCII 0x46
        {0b00000000, 0b00000000, 0b00111000, 0b01000000, 0b01000000, 0b01011000, 0b01001000, 0b00111000}, // ASCII 0x47
        {0b00000000, 0b00000000, 0b01001000, 0b01001000, 0b01001000, 0b01111000, 0b01001000, 0b01001000}, // ASCII 0x48
        {0b00000000, 0b00000000, 0b01110000, 0b00100000, 0b00100000, 0b00100000, 0b00100000, 0b01110000}, // ASCII 0x49
        {0b00000000, 0b00000000, 0b00110000, 0b00010000, 0b00010000, 0b00010000, 0b00010000, 0b01110000}, // ASCII 0x4A
        {0b00000000, 0b00000000, 0b01001000, 0b01010000, 0b01100000, 0b01010000, 0b01010000, 0b01001000}, // ASCII 0x4B
        {0b00000000, 0b00000000, 0b01000000, 0b01000000, 0b01000000, 0b01000000, 0b01000000, 0b01111000}, // ASCII 0x4C
        {0b00000000, 0b00000000, 0b01001000, 0b01111000, 0b01111000, 0b01111000, 0b01001000, 0b01001000}, // ASCII 0x4D
        {0b00000000, 0b00000000, 0b01001000, 0b01101000, 0b01101000, 0b01011000, 0b01011000, 0b01001000}, // ASCII 0x4E
        {0b00000000, 0b00000000, 0b00110000, 0b01001000, 0b01001000, 0b01001000, 0b01001000, 0b00110000}, // ASCII 0x4F
        {0b00000000, 0b00000000, 0b01111000, 0b01001000, 0b01111000, 0b01000000, 0b01000000, 0b01000000}, // ASCII 0x50
        {0b00000000, 0b00000000, 0b00110000, 0b01001000, 0b01001000, 0b01001000, 0b01001000, 0b00110000}, // ASCII 0x51
        {0b00000000, 0b00000000, 0b01111000, 0b01001000, 0b01110000, 0b01011000, 0b01001000, 0b01000100}, // ASCII 0x52
        {0b00000000, 0b00000000, 0b00111000, 0b01000000, 0b01110000, 0b00011000, 0b00001000, 0b01111000}, // ASCII 0x53
        {0b00000000, 0b00000000, 0b11111000, 0b00100000, 0b00100000, 0b00100000, 0b00100000, 0b00100000}, // ASCII 0x54
        {0b00000000, 0b00000000, 0b01001000, 0b01001000, 0b01001000, 0b01001000, 0b01001000, 0b00110000}, // ASCII 0x55
        {0b00000000, 0b00000000, 0b01001000, 0b01001000, 0b00110000, 0b00110000, 0b00110000, 0b00110000}, // ASCII 0x56
        {0b00000000, 0b00000000, 0b10001000, 0b10001000, 0b10101000, 0b01010000, 0b01010000, 0b01010000}, // ASCII 0x57
        {0b00000000, 0b00000000, 0b01001000, 0b00110000, 0b00110000, 0b00110000, 0b00110000, 0b01001000}, // ASCII 0x58
        {0b00000000, 0b00000000, 0b10001000, 0b01010000, 0b00100000, 0b00100000, 0b00100000, 0b00100000}, // ASCII 0x59
        {0b00000000, 0b00000000, 0b01111000, 0b00010000, 0b00010000, 0b00100000, 0b00100000, 0b01111000}, // ASCII 0x5A
        {0b00000000, 0b00110000, 0b00100000, 0b00100000, 0b00100000, 0b00100000, 0b00100000, 0b00110000}, // ASCII 0x5B
        {0b00000000, 0b00000000, 0b10000000, 0b01000000, 0b01000000, 0b01100000, 0b00100000, 0b00100000}, // ASCII 0x5C
        {0b00000000, 0b01100000, 0b00100000, 0b00100000, 0b00100000, 0b00100000, 0b00100000, 0b01100000}, // ASCII 0x5D
        {0b00000000, 0b00000000, 0b01100000, 0b10010000, 0b00000000, 0b00000000, 0b00000000, 0b00000000}, // ASCII 0x5E
        {0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000}, // ASCII 0x5F
        {0b00000000, 0b00000000, 0b01000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000}, // ASCII 0x60
        {0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b01111000, 0b01111000, 0b01001000, 0b01111000}, // ASCII 0x61
        {0b00000000, 0b01000000, 0b01000000, 0b01000000, 0b01110000, 0b01001000, 0b01001000, 0b01110000}, // ASCII 0x62
        {0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00110000, 0b01000000, 0b01000000, 0b00110000}, // ASCII 0x63
        {0b00000000, 0b00001000, 0b00001000, 0b00001000, 0b00111000, 0b01001000, 0b01001000, 0b00111000}, // ASCII 0x64
        {0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00111000, 0b01111000, 0b01000000, 0b00111000}, // ASCII 0x65
        {0b00000000, 0b00011000, 0b00100000, 0b00100000, 0b01111000, 0b00100000, 0b00100000, 0b00100000}, // ASCII 0x66
        {0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00111000, 0b01001000, 0b01001000, 0b00111000}, // ASCII 0x67
        {0b00000000, 0b01000000, 0b01000000, 0b01000000, 0b01111000, 0b01001000, 0b01001000, 0b01001000}, // ASCII 0x68
        {0b00000000, 0b00100000, 0b00000000, 0b00000000, 0b01100000, 0b00100000, 0b00100000, 0b01110000}, // ASCII 0x69
        {0b00000000, 0b00100000, 0b00000000, 0b00000000, 0b01100000, 0b00100000, 0b00100000, 0b00100000}, // ASCII 0x6A
        {0b00000000, 0b01000000, 0b01000000, 0b01000000, 0b01011000, 0b01110000, 0b01110000, 0b01011000}, // ASCII 0x6B
        {0b00000000, 0b01100000, 0b00100000, 0b00100000, 0b00100000, 0b00100000, 0b00100000, 0b00111000}, // ASCII 0x6C
        {0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b01111100, 0b01010100, 0b01010100, 0b01010100}, // ASCII 0x6D
        {0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b01111000, 0b01001000, 0b01001000, 0b01001000}, // ASCII 0x6E
        {0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00110000, 0b01001000, 0b01001000, 0b00110000}, // ASCII 0x6F
        {0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b01110000, 0b01001000, 0b01001000, 0b01110000}, // ASCII 0x70
        {0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00111000, 0b01001000, 0b01001000, 0b00111000}, // ASCII 0x71
        {0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b01110000, 0b01000000, 0b01000000, 0b01000000}, // ASCII 0x72
        {0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b01111000, 0b01110000, 0b00001000, 0b01111000}, // ASCII 0x73
        {0b00000000, 0b00000000, 0b00000000, 0b00100000, 0b01111000, 0b00100000, 0b00100000, 0b00111000}, // ASCII 0x74
        {0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b01001000, 0b01001000, 0b01001000, 0b01111000}, // ASCII 0x75
        {0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b01001000, 0b00110000, 0b00110000, 0b00110000}, // ASCII 0x76
        {0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b10001000, 0b10101000, 0b01110000, 0b01010000}, // ASCII 0x77
        {0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b01111000, 0b00110000, 0b00110000, 0b01111000}, // ASCII 0x78
        {0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b01001000, 0b00110000, 0b00110000, 0b00100000}, // ASCII 0x79
        {0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b01111000, 0b00110000, 0b00100000, 0b01111000}, // ASCII 0x7A
        {0b00000000, 0b00110000, 0b00100000, 0b00100000, 0b01000000, 0b00100000, 0b00100000, 0b00110000}, // ASCII 0x7B
        {0b00000000, 0b00100000, 0b00100000, 0b00100000, 0b00100000, 0b00100000, 0b00100000, 0b00100000}, // ASCII 0x7C
        {0b00000000, 0b01100000, 0b00100000, 0b00100000, 0b00010000, 0b00100000, 0b00100000, 0b01100000}, // ASCII 0x7D
        {0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b01111000, 0b00000000, 0b00000000}, // ASCII 0x7E
    };
};